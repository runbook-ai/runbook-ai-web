<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runbook AI</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f7fa;
      color: #1a1a2e;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 48px 16px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #1a1a2e;
      letter-spacing: -0.5px;
    }

    header p {
      margin-top: 8px;
      font-size: 1rem;
      color: #6b7280;
      max-width: 560px;
    }

    .card {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 32px;
      width: 100%;
      max-width: 820px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .field {
      margin-bottom: 20px;
    }

    .label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 6px;
    }

    select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9375rem;
      color: #374151;
      background: #f9fafb;
      outline: none;
      cursor: pointer;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
      background: #ffffff;
    }

    textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.875rem;
      line-height: 1.65;
      color: #374151;
      background: #f9fafb;
      resize: vertical;
      transition: border-color 0.15s, box-shadow 0.15s;
      outline: none;
    }

    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
      background: #ffffff;
    }

    #promptArea  { height: 240px; }
    #configArea  { height: 100px; }

    .actions {
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    button#runBtn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 24px;
      background: #6366f1;
      color: #ffffff;
      font-size: 0.9375rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      white-space: nowrap;
    }

    button#runBtn:hover  { background: #4f46e5; }
    button#runBtn:active { transform: scale(0.97); }
    button#runBtn:disabled {
      background: #a5b4fc;
      cursor: not-allowed;
      transform: none;
    }

    .run-hint {
      font-size: 0.8125rem;
      color: #9ca3af;
      font-style: italic;
    }

    #status              { font-size: 0.875rem; color: #6b7280; }
    #status.success      { color: #059669; }
    #status.error        { color: #dc2626; }

    footer {
      margin-top: 40px;
      font-size: 0.8125rem;
      color: #9ca3af;
      text-align: center;
    }

    footer a { color: #6366f1; text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>

  <header>
    <h1>ðŸ¤– Runbook AI</h1>
    <p>Discover and share runbooks for the <a href="https://chromewebstore.google.com/detail/runbook-ai/kjbhngehjkiiecaflccjenmoccielojj" target="_blank">Runbook AI Chrome extension</a> â€” your AI agent for autonomous web tasks.</p>
  </header>

  <div class="card">

    <div class="field">
      <label class="label" for="runbookSelect">Select a Runbook</label>
      <select id="runbookSelect">
        <option value="">-- Choose a runbook --</option>
        <option value="craigslist-car-listings">ðŸš— Craigslist Car Listings</option>
      </select>
    </div>

    <div class="field">
      <label class="label" for="promptArea">Prompt</label>
      <textarea id="promptArea" placeholder="Select a runbook above to load its promptâ€¦"></textarea>
    </div>

    <div class="field">
      <label class="label" for="configArea">Config (JSON)</label>
      <textarea id="configArea" placeholder="Select a runbook above to load its configâ€¦"></textarea>
    </div>

    <div class="actions">
      <button id="runBtn" disabled>â–¶ Run</button>
      <span class="run-hint">When clicked, this runbook will be executed by the Runbook AI extension.</span>
      <span id="status"></span>
    </div>

  </div>

  <footer>
    Powered by <a href="https://github.com/runbook-ai" target="_blank">Runbook AI</a> &mdash;
    <a href="https://chromewebstore.google.com/detail/runbook-ai/kjbhngehjkiiecaflccjenmoccielojj" target="_blank">Install Chrome Extension</a> &mdash;
    Want to share your runbook? <a href="https://github.com/runbook-ai/runbook-ai.github.io" target="_blank">Send a PR</a>
  </footer>

  <script>
    const EXTENSION_ID = "kjbhngehjkiiecaflccjenmoccielojj";

    const runbookSelect = document.getElementById("runbookSelect");
    const promptArea    = document.getElementById("promptArea");
    const configArea    = document.getElementById("configArea");
    const runBtn        = document.getElementById("runBtn");
    const status        = document.getElementById("status");

    runbookSelect.addEventListener("change", async () => {
      const name = runbookSelect.value;
      status.textContent = "";
      status.className = "";

      if (!name) {
        promptArea.value = "";
        configArea.value = "";
        runBtn.disabled = true;
        return;
      }

      try {
        const [mdRes, jsonRes] = await Promise.all([
          fetch(`runbooks/${name}.md`),
          fetch(`runbooks/${name}.json`),
        ]);
        promptArea.value = mdRes.ok   ? await mdRes.text()   : "(Failed to load prompt)";
        configArea.value = jsonRes.ok ? await jsonRes.text() : "{}";
        runBtn.disabled = false;
      } catch (err) {
        console.error(err);
        promptArea.value = "";
        configArea.value = "";
        status.textContent = "Failed to load runbook files.";
        status.className = "error";
        runBtn.disabled = true;
      }
    });

    async function startRunbook(prompt, config) {
      return await chrome.runtime.sendMessage(EXTENSION_ID, { action: "start-runbook", prompt, config });
    }

    runBtn.addEventListener("click", async () => {
      const prompt = promptArea.value.trim();

      if (!prompt) {
        status.textContent = "Prompt is empty.";
        status.className = "error";
        return;
      }

      let config = {};
      try {
        config = JSON.parse(configArea.value || "{}");
      } catch (e) {
        status.textContent = "Config JSON is invalid.";
        status.className = "error";
        return;
      }

      runBtn.disabled = true;
      status.textContent = "Starting runbookâ€¦";
      status.className = "";

      try {
        const timeout = new Promise(resolve => setTimeout(() => resolve(null), 1000));
        const result = await Promise.race([startRunbook(prompt, config), timeout]);

        if (result === null) {
          // Timed out â€” runbook is running in the extension
          status.textContent = "Runbook is running in the Runbook AI extension.";
          status.className = "success";
        } else if (result?.error) {
          status.textContent = result.message || result.error;
          status.className = "error";
        } else {
          status.textContent = result?.message ?? "Runbook started successfully.";
          status.className = "success";
        }
      } catch (err) {
        console.error(err);
        status.textContent = "Failed to start runbook. Make sure the Runbook AI extension is installed and enabled.";
        status.className = "error";
      } finally {
        runBtn.disabled = false;
      }
    });
  </script>

</body>
</html>
